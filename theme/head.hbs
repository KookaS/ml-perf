<script async src="https://www.googletagmanager.com/gtag/js?id=G-XTC0RF0JXF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XTC0RF0JXF');
</script>

<script src="https://unpkg.com/thebe@latest/lib/index.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    
    // CHECK: Only run if the "activator" div exists on this page
    const activator = document.getElementById("thebe-activate");
    if (!activator) {
        return; // Exit if this page doesn't need a playground
    }

    const isLocal = window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1";

    // CONFIG: Define your repo and settings
    let thebeConfig;
    
    if (isLocal) {
        thebeConfig = {
            requestKernel: true,
            binderOptions: {
                repo: "n/a",
                binderUrl: "n/a",
            },
            useBinder: false,
            useJupyterLite: false,
            codeMirrorConfig: {
                theme: "abcdef",
                mode: "python"
            },
            kernelOptions: {
                name: "ml-perf",
                serverSettings: {
                    "baseUrl": "http://127.0.0.1:8888",
                    "wsUrl": "ws://127.0.0.1:8888",
                    "token": ""
                }
            },
            selector: "code.language-python"
        };
    } else {
        // Extract owner/repo from GitHub Pages URL
        // URL format: https://{owner}.github.io/{repo}/
        const owner = window.location.hostname.split('.')[0];
        const repo = window.location.pathname.split('/')[1];
        const binderRepo = `${owner}/${repo}`;

        thebeConfig = {
            requestKernel: true,
            binderOptions: {
                repo: binderRepo,
                ref: "main",
            },
            codeMirrorConfig: {
                theme: "abcdef",
                mode: "python"
            },
            kernelOptions: {
                name: "python3",
                path: "./"
            },
            selector: "code.language-python"
        };
    }

    // UI: Create a sophisticated "Launch" button inside the activator div
    const btn = document.createElement("button");
    btn.innerHTML = "▶️ Initialize Playground";
    btn.className = "playground-button";
    btn.style = "padding: 10px 20px; background: #333; color: #fff; border: none; border-radius: 4px; cursor: pointer; margin-bottom: 20px;";
    
    thebe.on("status", (evt, data) => console.log("Status:", data));
    thebe.on("error", (evt, data) => console.log("Error:", data));

    btn.onclick = async () => {
        btn.innerHTML = "⏳ Connecting...";
        btn.disabled = true;
        
        try {
            thebe.on("status", (evt, data) => {
                console.log("Status:", data);
                if (data.status === "server-ready" || data.subject === "notebook") {
                    btn.innerHTML = "✅ Environment Ready";
                    btn.style.background = "#4CAF50";
                }
            });
            
            thebe.on("error", (evt, data) => {
                console.error("Thebe error:", data);
                btn.innerHTML = "❌ Connection failed";
                btn.style.background = "#e53935";
                btn.disabled = false;
            });
            
            thebe.bootstrap(thebeConfig);
        } catch (err) {
            console.error("Bootstrap error:", err);
            btn.innerHTML = "❌ Error: " + err.message;
            btn.style.background = "#e53935";
            btn.disabled = false;
        }
    };

    activator.appendChild(btn);
});
</script>